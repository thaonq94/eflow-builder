(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{3332:(e,t,a)=>{Promise.resolve().then(a.bind(a,752))},752:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eD});var s=a(5155),r=a(2115),i=a(415),n=a(1077);a(6419);var l=a(8474),o=a(5870),d=a(905),c=a(5262),g=a(7517),x=a(7072),u=a(3348),h=a(6462),m=a(9271),p=a(5471),b=a(8256),y=a(8670),f=a(1024),v=a(6889),j=a(7694),N=a(8983),w=a(1773),k=a(5288),A=a(3473),C=a(1719),S=a(1567);function z(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,S.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function T(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,S.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function L(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,S.cn)("leading-none font-semibold",t),...a})}function D(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,S.cn)("text-muted-foreground text-sm",t),...a})}function O(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,S.cn)("px-6",t),...a})}let B=e=>{switch(e){case"order-created":return(0,s.jsx)(l.A,{className:"w-4 h-4 text-orange-500"});case"cart-abandoned":return(0,s.jsx)(o.A,{className:"w-4 h-4 text-orange-500"});case"customer-birthday":return(0,s.jsx)(d.A,{className:"w-4 h-4 text-orange-500"});case"no-purchase-90d":return(0,s.jsx)(c.A,{className:"w-4 h-4 text-orange-500"});case"zalo-oa-followed":return(0,s.jsx)(g.A,{className:"w-4 h-4 text-orange-500"});case"custom-event":return(0,s.jsx)(x.A,{className:"w-4 h-4 text-orange-500"});case"send-zns":return(0,s.jsx)(u.A,{className:"w-4 h-4 text-blue-500"});case"send-email-sms":return(0,s.jsx)(h.A,{className:"w-4 h-4 text-blue-500"});case"send-zalo-chat":return(0,s.jsx)(m.A,{className:"w-4 h-4 text-blue-500"});case"add-tag":return(0,s.jsx)(p.A,{className:"w-4 h-4 text-blue-500"});case"update-field":return(0,s.jsx)(b.A,{className:"w-4 h-4 text-blue-500"});case"webhook":return(0,s.jsx)(y.A,{className:"w-4 h-4 text-blue-500"});case"run-code":return(0,s.jsx)(f.A,{className:"w-4 h-4 text-blue-500"});case"wait":return(0,s.jsx)(v.A,{className:"w-4 h-4 text-purple-500"});case"decision":return(0,s.jsx)(j.A,{className:"w-4 h-4 text-purple-500"});case"split-ab":return(0,s.jsx)(N.A,{className:"w-4 h-4 text-purple-500"});case"loop":return(0,s.jsx)(w.A,{className:"w-4 h-4 text-purple-500"});case"email":return(0,s.jsx)(h.A,{className:"w-4 h-4 text-emerald-500"});case"sms":return(0,s.jsx)(u.A,{className:"w-4 h-4 text-emerald-500"});case"update-profile":return(0,s.jsx)(b.A,{className:"w-4 h-4 text-rose-400"});case"notification":return(0,s.jsx)(k.A,{className:"w-4 h-4 text-amber-500"});case"delay":return(0,s.jsx)(v.A,{className:"w-4 h-4 text-blue-500"});case"condition":return(0,s.jsx)(N.A,{className:"w-4 h-4 text-indigo-600"});default:return null}},G=(0,r.memo)(e=>{let{data:t,selected:a}=e,r=B(t.actionType);return(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsx)(n.h7,{type:"target",position:i.yX.Top,className:"w-2 h-2 !bg-gray-300 border-2 border-white"}),(0,s.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)("div",{className:"bg-indigo-600 rounded-full p-0.5 text-white shadow-lg cursor-pointer",children:(0,s.jsx)(A.A,{className:"w-3 h-3"})})}),(0,s.jsxs)(z,{className:(0,S.cn)("w-[220px] bg-white border-gray-200 overflow-hidden shadow-sm transition-all",a&&"ring-2 ring-indigo-500 ring-offset-2"),children:[(0,s.jsxs)("div",{className:"p-3 flex items-start gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-gray-50 flex items-center justify-center border border-gray-100",children:r}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:t.label}),(0,s.jsx)(C.A,{className:"w-3 h-3 text-gray-400"})]}),(0,s.jsxs)("p",{className:"text-[10px] text-gray-500 capitalize",children:[t.actionType," ","logic"===t.category?"":"action"]})]})]}),(0,s.jsx)("div",{className:"px-3 pb-3",children:(0,s.jsx)("div",{className:"bg-amber-50 border border-amber-100 rounded-md py-1.5 px-3",children:(0,s.jsxs)("p",{className:"text-[10px] text-amber-700 font-medium truncate",children:["Set up ",t.label]})})})]}),(0,s.jsx)(n.h7,{type:"source",position:i.yX.Bottom,className:"w-2 h-2 !bg-gray-300 border-2 border-white"}),(0,s.jsx)("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)("div",{className:"bg-indigo-600 rounded-full p-0.5 text-white shadow-lg cursor-pointer",children:(0,s.jsx)(A.A,{className:"w-3 h-3"})})})]})}),E=(0,r.memo)(e=>{let{data:t,selected:a}=e;return(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsx)(n.h7,{type:"target",position:i.yX.Top,className:"w-2 h-2 !bg-gray-300 border-2 border-white"}),(0,s.jsxs)(z,{className:(0,S.cn)("w-[220px] bg-white border-gray-200 overflow-hidden shadow-sm transition-all",a&&"ring-2 ring-indigo-500 ring-offset-2"),children:[(0,s.jsxs)("div",{className:"p-3 flex items-start gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-gray-50 flex items-center justify-center border border-gray-100",children:(0,s.jsx)(N.A,{className:"w-4 h-4 text-indigo-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:t.label}),(0,s.jsx)(C.A,{className:"w-3 h-3 text-gray-400"})]}),(0,s.jsx)("p",{className:"text-[10px] text-gray-500",children:"condition"})]})]}),(0,s.jsx)("div",{className:"px-3 pb-3",children:(0,s.jsx)("div",{className:"bg-amber-50 border border-amber-100 rounded-md py-1.5 px-3",children:(0,s.jsx)("p",{className:"text-[10px] text-amber-700 font-medium",children:"Set up conditional split"})})})]}),(0,s.jsx)(n.h7,{type:"source",position:i.yX.Bottom,id:"no",style:{left:"25%"},className:"w-2 h-2 !bg-gray-300 border-2 border-white"}),(0,s.jsx)(n.h7,{type:"source",position:i.yX.Bottom,id:"yes",style:{left:"75%"},className:"w-2 h-2 !bg-gray-300 border-2 border-white"})]})}),I=(0,r.memo)(e=>{let{data:t}=e;return(0,s.jsxs)("div",{className:"bg-white border-2 border-gray-200 rounded-sm px-12 py-3 shadow-none min-w-[140px] flex items-center justify-center",children:[(0,s.jsx)(n.h7,{type:"source",position:i.yX.Bottom,className:"w-2 h-2 !bg-gray-300 border-2 border-white"}),(0,s.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:t.label}),(0,s.jsx)("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)("div",{className:"bg-indigo-600 rounded-full p-0.5 text-white shadow-lg cursor-pointer",children:(0,s.jsx)(A.A,{className:"w-3 h-3"})})})]})});G.displayName="ActionNode",E.displayName="ConditionNode",I.displayName="TriggerNode";var _=a(3312);let P={action:G,condition:E,trigger:I};function F(e){let{nodes:t,edges:a,onNodesChange:i,onEdgesChange:l,onConnect:o,onNodeClick:d,onDrop:c,onDragOver:g,onLayout:x}=e,u=(0,r.useMemo)(()=>a.map(e=>"yes"===e.sourceHandle?{...e,label:"Yes",labelStyle:{fill:"#059669",fontWeight:600,fontSize:10},labelBgStyle:{fill:"#ecfdf5",fillOpacity:1},labelBgPadding:[4,2],labelBgBorderRadius:4,style:{stroke:"#10b981",strokeWidth:2}}:"no"===e.sourceHandle?{...e,label:"No",labelStyle:{fill:"#dc2626",fontWeight:600,fontSize:10},labelBgStyle:{fill:"#fef2f2",fillOpacity:1},labelBgPadding:[4,2],labelBgBorderRadius:4,style:{stroke:"#ef4444",strokeWidth:2}}:{...e,style:{stroke:"#94a3b8",strokeWidth:2}}),[a]);return(0,s.jsx)("div",{className:"w-full h-full bg-[#f8fafc] reactflow-wrapper",onDrop:c,onDragOver:g,children:(0,s.jsxs)(n.Gc,{nodes:t,edges:u,onNodesChange:i,onEdgesChange:l,onConnect:o,onNodeClick:d,nodeTypes:P,fitView:!0,snapToGrid:!0,snapGrid:[15,15],children:[(0,s.jsx)(n.H2,{position:"bottom-left"}),(0,s.jsx)(n.VS,{variant:n._5.Dots,gap:20,size:1,color:"#cbd5e1"}),(0,s.jsx)(n.Zk,{position:"top-left",className:"flex gap-2",children:(0,s.jsx)(_.$,{variant:"secondary",size:"sm",onClick:x,className:"bg-[#8b5cf6] hover:bg-[#7c3aed] text-white border-none shadow-sm h-8 px-4 font-semibold",children:"Layout"})})]})})}var M=a(9606),V=a(2679),W=a(534),H=a(2317),X=a(6195);function $(e){let{className:t,...a}=e;return(0,s.jsx)(X.b,{"data-slot":"label",className:(0,S.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}let R=M.Op,Z=r.createContext({}),U=e=>{let{...t}=e;return(0,s.jsx)(Z.Provider,{value:{name:t.name},children:(0,s.jsx)(M.xI,{...t})})},q=()=>{let e=r.useContext(Z),t=r.useContext(J),{getFieldState:a}=(0,M.xW)(),s=(0,M.lN)({name:e.name}),i=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...i}},J=r.createContext({});function Y(e){let{className:t,...a}=e,i=r.useId();return(0,s.jsx)(J.Provider,{value:{id:i},children:(0,s.jsx)("div",{"data-slot":"form-item",className:(0,S.cn)("grid gap-2",t),...a})})}function K(e){let{className:t,...a}=e,{error:r,formItemId:i}=q();return(0,s.jsx)($,{"data-slot":"form-label","data-error":!!r,className:(0,S.cn)("data-[error=true]:text-destructive",t),htmlFor:i,...a})}function Q(e){let{...t}=e,{error:a,formItemId:r,formDescriptionId:i,formMessageId:n}=q();return(0,s.jsx)(H.bL,{"data-slot":"form-control",id:r,"aria-describedby":a?"".concat(i," ").concat(n):"".concat(i),"aria-invalid":!!a,...t})}function ee(e){var t;let{className:a,...r}=e,{error:i,formMessageId:n}=q(),l=i?String(null!==(t=null==i?void 0:i.message)&&void 0!==t?t:""):r.children;return l?(0,s.jsx)("p",{"data-slot":"form-message",id:n,className:(0,S.cn)("text-destructive text-sm",a),...r,children:l}):null}function et(e){let{className:t,type:a,...r}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:(0,S.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var ea=a(434);function es(e){let{className:t,orientation:a="horizontal",decorative:r=!0,...i}=e;return(0,s.jsx)(ea.b,{"data-slot":"separator",decorative:r,orientation:a,className:(0,S.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...i})}let er=(0,a(1027).F)("inline-flex items-center justify-center rounded-full border border-transparent px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",ghost:"[a&]:hover:bg-accent [a&]:hover:text-accent-foreground",link:"text-primary underline-offset-4 [a&]:hover:underline"}},defaultVariants:{variant:"default"}});function ei(e){let{className:t,variant:a="default",asChild:r=!1,...i}=e,n=r?H.bL:"span";return(0,s.jsx)(n,{"data-slot":"badge","data-variant":a,className:(0,S.cn)(er({variant:a}),t),...i})}var en=a(5047);let el=W.Ikc({label:W.YjP().min(1,"Label is required")});function eo(e){let{selectedNode:t,onUpdate:a}=e,i=(0,M.mN)({resolver:(0,V.u)(el),defaultValues:{label:""}});if((0,r.useEffect)(()=>{t&&i.reset({label:t.data.label||""})},[t,i]),!t)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-6 bg-gray-50/50 rounded-xl border border-dashed border-gray-200",children:[(0,s.jsx)(en.A,{className:"w-10 h-10 text-gray-300 mb-2"}),(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"No node selected"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Select a node on the canvas to edit its properties and configuration."})]});let n=t.data.actionType,l=t.data.category;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"Properties"}),(0,s.jsx)(ei,{variant:"secondary",className:"capitalize bg-indigo-50 text-indigo-700 hover:bg-indigo-50 border-none px-2 py-0",children:l||"Node"})]}),(0,s.jsxs)(z,{className:"border-gray-200 shadow-none",children:[(0,s.jsxs)(T,{className:"p-4 pb-2",children:[(0,s.jsx)(L,{className:"text-sm font-bold truncate",children:t.data.label}),(0,s.jsx)(D,{className:"text-[10px] uppercase tracking-wider",children:t.id})]}),(0,s.jsxs)(O,{className:"p-4 pt-0",children:[(0,s.jsx)(es,{className:"my-4"}),(0,s.jsx)(R,{...i,children:(0,s.jsxs)("form",{onSubmit:i.handleSubmit(e=>{t&&a(t.id,{label:e.label})}),className:"space-y-4",children:[(0,s.jsx)(U,{control:i.control,name:"label",render:e=>{let{field:t}=e;return(0,s.jsxs)(Y,{children:[(0,s.jsx)(K,{className:"text-xs font-bold text-gray-700",children:"Display Name"}),(0,s.jsx)(Q,{children:(0,s.jsx)(et,{...t,placeholder:"Enter node label",className:"h-9 text-sm focus-visible:ring-indigo-500"})}),(0,s.jsx)(ee,{className:"text-[10px]"})]})}}),n&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-xs font-bold text-gray-700",children:"Cấu h\xecnh chi tiết"}),(0,s.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-100",children:["trigger"===l&&(0,s.jsxs)("p",{className:"text-[10px] text-gray-500 font-medium",children:["Đ\xe2y l\xe0 điểm bắt đầu luồng: ",(0,s.jsx)("span",{className:"text-orange-600 font-bold uppercase",children:t.data.label}),". Luồng sẽ tự động chạy khi sự kiện n\xe0y xảy ra."]}),"action"===l&&(0,s.jsxs)("p",{className:"text-[10px] text-gray-500 font-medium",children:["H\xe0nh động thực hiện: ",(0,s.jsx)("span",{className:"text-blue-600 font-bold uppercase",children:t.data.label}),". Hệ thống sẽ thực hiện t\xe1c vụ n\xe0y cho kh\xe1ch h\xe0ng trong luồng."]}),"logic"===l&&(0,s.jsxs)("p",{className:"text-[10px] text-gray-500 font-medium",children:["Điều khiển logic: ",(0,s.jsx)("span",{className:"text-purple-600 font-bold uppercase",children:t.data.label}),". D\xf9ng để ph\xe2n nh\xe1nh hoặc điều hướng luồng."]}),!["trigger","action","logic"].includes(l)&&(0,s.jsxs)("p",{className:"text-[10px] text-gray-500 font-medium",children:["Loại th\xe0nh phần: ",(0,s.jsx)("span",{className:"text-indigo-600 font-bold uppercase",children:n}),". T\xf9y chỉnh cấu h\xecnh b\xean dưới."]})]})]}),(0,s.jsx)(_.$,{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700 h-9 text-sm font-semibold shadow-md shadow-indigo-100 mt-2",children:"Lưu thay đổi"})]})})]})]}),(0,s.jsxs)("div",{className:"p-4 bg-amber-50 border border-amber-100 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-[10px] font-bold text-amber-800 uppercase mb-1",children:"Lưu \xfd"}),(0,s.jsx)("p",{className:"text-[10px] text-amber-700 leading-relaxed",children:'Cấu h\xecnh được tự động cập nhật v\xe0o danh s\xe1ch luồng, nhưng bạn phải nhấn "Lưu thay đổi" để \xe1p dụng c\xe1c thay đổi v\xe0o trạng th\xe1i của n\xfat hiện tại.'})]})]})}var ed=a(790),ec=a(674);function eg(e){let{className:t,children:a,hideScrollbar:r=!1,...i}=e;return(0,s.jsxs)(ec.bL,{"data-slot":"scroll-area",className:(0,S.cn)("relative overflow-hidden",t),...i,children:[(0,s.jsx)(ec.LM,{"data-slot":"scroll-area-viewport",className:(0,S.cn)("focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",r&&"[&::-webkit-scrollbar]:hidden [scrollbar-width:none] [-ms-overflow-style:none]"),children:a}),!r&&(0,s.jsx)(ex,{}),(0,s.jsx)(ec.OK,{})]})}function ex(e){let{className:t,orientation:a="vertical",...r}=e;return(0,s.jsx)(ec.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,S.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:(0,s.jsx)(ec.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function eu(e){let{flows:t,activeFlowId:a,onSelect:i,onCreate:n}=e,[l,o]=r.useState(!1);return r.useEffect(()=>{o(!0)},[]),(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex items-center justify-between bg-gray-50/50",children:[(0,s.jsxs)("h2",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(ed.A,{className:"w-4 h-4 text-indigo-600"}),"Flows"]}),(0,s.jsx)(_.$,{variant:"outline",size:"icon",onClick:n,className:"h-7 w-7 rounded-md border-gray-200 hover:border-indigo-200 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 transition-colors",children:(0,s.jsx)(A.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsx)(eg,{className:"flex-1",children:(0,s.jsx)("div",{className:"p-2 space-y-1",children:t.map(e=>{let t=e.id===a;return(0,s.jsxs)("button",{onClick:()=>i(e),className:(0,S.cn)("w-full flex flex-col items-start gap-1 p-3 rounded-lg text-left transition-all duration-200 group",t?"bg-indigo-50 border border-indigo-100 ring-1 ring-indigo-100":"hover:bg-gray-50 border border-transparent hover:border-gray-100"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsx)("span",{className:(0,S.cn)("text-sm font-medium truncate pr-2",t?"text-indigo-900":"text-gray-700 group-hover:text-gray-900"),children:e.name}),t&&(0,s.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-gray-400 font-medium",children:[(0,s.jsx)(v.A,{className:"w-3 h-3"}),l?new Date(e.updatedAt).toLocaleDateString():"Loading..."]})]},e.id)})})}),(0,s.jsx)("div",{className:"p-3 border-t bg-gray-50/30",children:(0,s.jsxs)("div",{className:"bg-indigo-600 rounded-lg p-3 text-white",children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold opacity-90 mb-1",children:"Pro Tip"}),(0,s.jsx)("p",{className:"text-[10px] leading-relaxed opacity-80",children:"K\xe9o v\xe0 thả c\xe1c th\xe0nh phần từ thanh menu để x\xe2y dựng luồng tự động."})]})})]})}var eh=a(6967),em=a(7530);let ep=[{id:"triggers",title:"Triggers (Điểm khởi đầu)",items:[{id:"order-created",label:"Đơn h\xe0ng mới",icon:(0,s.jsx)(l.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"},{id:"cart-abandoned",label:"Giỏ h\xe0ng bỏ qu\xean",icon:(0,s.jsx)(o.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"},{id:"customer-birthday",label:"Sinh nhật kh\xe1ch",icon:(0,s.jsx)(d.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"},{id:"no-purchase-90d",label:"90 ng\xe0y kh\xf4ng mua",icon:(0,s.jsx)(c.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"},{id:"zalo-oa-followed",label:"Follow Zalo OA",icon:(0,s.jsx)(g.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"},{id:"custom-event",label:"Sự kiện t\xf9y chỉnh",icon:(0,s.jsx)(x.A,{className:"w-4 h-4 text-orange-500"}),type:"trigger"}]},{id:"actions",title:"Actions (H\xe0nh động)",items:[{id:"send-zns",label:"Gửi tin ZNS",icon:(0,s.jsx)(u.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"send-email-sms",label:"Gửi Email/SMS",icon:(0,s.jsx)(h.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"send-zalo-chat",label:"Gửi tin nhắn Zalo",icon:(0,s.jsx)(m.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"add-tag",label:"Add Tag (Gắn thẻ)",icon:(0,s.jsx)(p.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"update-field",label:"Cập nhật th\xf4ng tin",icon:(0,s.jsx)(b.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"webhook",label:"Webhook (Gọi API ngo\xe0i)",icon:(0,s.jsx)(y.A,{className:"w-4 h-4 text-blue-500"}),type:"action"},{id:"run-code",label:"Run code",icon:(0,s.jsx)(f.A,{className:"w-4 h-4 text-blue-500"}),type:"action"}]},{id:"logic",title:"Logic (Điều khiển)",items:[{id:"wait",label:"Chờ (Wait)",icon:(0,s.jsx)(v.A,{className:"w-4 h-4 text-purple-500"}),type:"logic"},{id:"decision",label:"Quyết định (If/Else)",icon:(0,s.jsx)(j.A,{className:"w-4 h-4 text-purple-500"}),type:"logic"},{id:"split-ab",label:"Chia nh\xf3m A/B",icon:(0,s.jsx)(N.A,{className:"w-4 h-4 text-purple-500"}),type:"logic"},{id:"loop",label:"Lặp lại (Loop)",icon:(0,s.jsx)(w.A,{className:"w-4 h-4 text-purple-500"}),type:"logic"}]},{id:"templates",title:"Templates (Mẫu c\xf3 sẵn)",items:[{id:"tpl-cart-recovery",label:"Cứu giỏ h\xe0ng bỏ qu\xean",icon:(0,s.jsx)(ed.A,{className:"w-4 h-4 text-emerald-500"}),type:"template"},{id:"tpl-post-purchase",label:"Chăm s\xf3c sau mua",icon:(0,s.jsx)(ed.A,{className:"w-4 h-4 text-emerald-500"}),type:"template"},{id:"tpl-win-back",label:"Cứu vớt kh\xe1ch cũ",icon:(0,s.jsx)(ed.A,{className:"w-4 h-4 text-emerald-500"}),type:"template"},{id:"tpl-vip-loyalty",label:"Chương tr\xecnh kh\xe1ch VIP",icon:(0,s.jsx)(ed.A,{className:"w-4 h-4 text-emerald-500"}),type:"template"}]}];function eb(e){let{onSelectTemplate:t}=e,[a,i]=(0,r.useState)(["triggers","actions","logic","templates"]),n=e=>{i(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},l=(e,t,a,s,r)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify({nodeType:t,label:a,actionType:s,category:r})),e.dataTransfer.effectAllowed="move"};return(0,s.jsxs)("aside",{className:"w-80 border-r bg-white h-full flex flex-col shadow-sm",children:[(0,s.jsx)("div",{className:"p-4 border-b bg-gray-50/50",children:(0,s.jsx)("h2",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider",children:"Th\xe0nh phần luồng"})}),(0,s.jsx)(eg,{className:"flex-1 min-h-0",children:(0,s.jsx)("div",{className:"p-2 space-y-1",children:ep.map(e=>(0,s.jsxs)("div",{className:"border-none",children:[(0,s.jsxs)("button",{onClick:()=>n(e.id),className:"w-full flex items-center justify-between px-3 py-3 hover:bg-gray-50 rounded-lg transition-colors group",children:[(0,s.jsx)("span",{className:"text-xs font-bold text-gray-700 uppercase",children:e.title}),a.includes(e.id)?(0,s.jsx)(C.A,{className:"w-4 h-4 text-gray-400 group-hover:text-gray-600"}):(0,s.jsx)(eh.A,{className:"w-4 h-4 text-gray-400 group-hover:text-gray-600"})]}),a.includes(e.id)&&(0,s.jsx)("div",{className:"pt-1 pb-4 px-1 space-y-1",children:e.items.map(e=>(0,s.jsxs)("div",{draggable:"template"!==e.type,onClick:()=>{"template"===e.type&&t&&t(e.id)},onDragStart:t=>l(t,"trigger"===e.type?"trigger":"logic"===e.type?"condition":"action",e.label,e.id,e.type),className:(0,S.cn)("flex items-center gap-3 p-2.5 rounded-lg border border-transparent transition-all group","template"===e.type?"cursor-pointer hover:bg-emerald-50 hover:border-emerald-100":"cursor-grab active:cursor-grabbing hover:bg-indigo-50 hover:border-indigo-100 shadow-none hover:shadow-sm"),children:[(0,s.jsx)("div",{className:(0,S.cn)("p-2 rounded-md transition-colors","template"===e.type?"bg-emerald-50 group-hover:bg-emerald-100":"bg-gray-50 group-hover:bg-indigo-100"),children:e.icon}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 truncate",children:e.label})}),"template"!==e.type&&(0,s.jsx)(em.A,{className:"w-4 h-4 text-gray-300 group-hover:text-indigo-300 transition-colors"})]},e.id))})]},e.id))})})]})}var ey=a(6448),ef=a.n(ey),ev=a(7364),ej=a(7936),eN=a(5796),ew=a(4857),ek=a(8173),eA=a.n(ek);let eC=[{id:"f1",name:"Marketing Campaign",nodes:[{id:"trigger-1",type:"trigger",position:{x:300,y:0},data:{label:"Bắt đầu"}},{id:"action-1",type:"condition",position:{x:300,y:150},data:{label:"Conditional Split",actionType:"condition"}}],edges:[{id:"e1-2",source:"trigger-1",target:"action-1"}],updatedAt:new Date().toISOString()}],eS=new(ef()),ez=async(e,t)=>{let a={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"DOWN","elk.spacing.nodeNode":"100","elk.layered.spacing.nodeNodeLayered":"100"},children:e.map(e=>({id:e.id,width:220,height:100})),edges:t.map(e=>({id:e.id,sources:[e.source],targets:[e.target]}))},s=await eS.layout(a);return{nodes:e.map(e=>{var t;let a=null===(t=s.children)||void 0===t?void 0:t.find(t=>t.id===e.id);return{...e,position:{x:((null==a?void 0:a.x)||0)+100,y:((null==a?void 0:a.y)||0)+50}}}),edges:t}},eT={"tpl-cart-recovery":{nodes:[{id:"t1",type:"trigger",position:{x:300,y:0},data:{label:"Giỏ h\xe0ng bỏ qu\xean",actionType:"cart-abandoned",category:"trigger"}},{id:"l1",type:"condition",position:{x:300,y:150},data:{label:"Chờ 1 giờ",actionType:"wait",category:"logic"}},{id:"a1",type:"action",position:{x:300,y:300},data:{label:"Gửi tin ZNS",actionType:"send-zns",category:"action"}},{id:"l2",type:"condition",position:{x:300,y:450},data:{label:"Kiểm tra đ\xe3 mua?",actionType:"decision",category:"logic"}}],edges:[{id:"e1",source:"t1",target:"l1"},{id:"e2",source:"l1",target:"a1"},{id:"e3",source:"a1",target:"l2"}]},"tpl-post-purchase":{nodes:[{id:"t1",type:"trigger",position:{x:300,y:0},data:{label:"Đơn h\xe0ng mới",actionType:"order-created",category:"trigger"}},{id:"l1",type:"condition",position:{x:300,y:150},data:{label:"Chờ 1 ng\xe0y",actionType:"wait",category:"logic"}},{id:"a1",type:"action",position:{x:300,y:300},data:{label:"Gửi tin nhắn Zalo",actionType:"send-zalo-chat",category:"action"}},{id:"a2",type:"action",position:{x:300,y:450},data:{label:"Gắn thẻ: Thank You",actionType:"add-tag",category:"action"}}],edges:[{id:"e1",source:"t1",target:"l1"},{id:"e2",source:"l1",target:"a1"},{id:"e3",source:"a1",target:"a2"}]},"tpl-win-back":{nodes:[{id:"t1",type:"trigger",position:{x:300,y:0},data:{label:"90 ng\xe0y kh\xf4ng mua",actionType:"no-purchase-90d",category:"trigger"}},{id:"a1",type:"action",position:{x:300,y:150},data:{label:"Gửi Email/SMS",actionType:"send-email-sms",category:"action"}},{id:"l1",type:"condition",position:{x:300,y:300},data:{label:"A/B Test Nội dung",actionType:"split-ab",category:"logic"}}],edges:[{id:"e1",source:"t1",target:"a1"},{id:"e2",source:"a1",target:"l1"}]},"tpl-vip-loyalty":{nodes:[{id:"t1",type:"trigger",position:{x:300,y:0},data:{label:"Đơn h\xe0ng mới",actionType:"order-created",category:"trigger"}},{id:"l1",type:"condition",position:{x:300,y:150},data:{label:"Gi\xe1 trị > 10M?",actionType:"decision",category:"logic"}},{id:"a1",type:"action",position:{x:100,y:300},data:{label:"Gắn thẻ VIP",actionType:"add-tag",category:"action"},targetPosition:i.yX.Left},{id:"a2",type:"action",position:{x:100,y:450},data:{label:"Gửi tin ZNS Ưu đ\xe3i",actionType:"send-zns",category:"action"}}],edges:[{id:"e1",source:"t1",target:"l1"},{id:"e2",source:"l1",target:"a1",sourceHandle:"yes"},{id:"e3",source:"a1",target:"a2"}]}};function eL(){let[e,t]=(0,r.useState)(eC),[a,l]=(0,r.useState)(eC[0].id),[o,d]=(0,r.useState)(!1),[c,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(!0)},[]);let[x,u,h]=(0,n.ck)(eC[0].nodes),[m,p,b]=(0,n.fM)(eC[0].edges),[y,f]=(0,r.useState)(null),{screenToFlowPosition:v,fitView:j}=(0,n.VH)();(0,r.useEffect)(()=>{t(e=>e.map(e=>e.id===a?{...e,nodes:x,edges:m,updatedAt:new Date().toISOString()}:e))},[x,m,a]);let N=(0,r.useCallback)(e=>{l(e.id),u(e.nodes),p(e.edges),f(null)},[u,p]),w=(0,r.useCallback)(()=>{let a={id:"f-".concat(Date.now()),name:"New Flow ".concat(e.length+1),nodes:[{id:"t1",type:"trigger",position:{x:300,y:0},data:{label:"Bắt đầu",actionType:"custom-event",category:"trigger"}}],edges:[],updatedAt:new Date().toISOString()};t([...e,a]),N(a)},[e,N]),k=(0,r.useCallback)(e=>{let t=eT[e];t&&(u(t.nodes),p(t.edges),f(null),setTimeout(()=>j(),50))},[u,p,j]),A=(0,r.useCallback)(e=>p(t=>(0,i.rN)(e,t)),[p]),C=(0,r.useCallback)((e,t)=>{f(t)},[]),S=(0,r.useCallback)((e,t)=>{u(a=>a.map(a=>a.id===e?{...a,data:{...a.data,...t}}:a)),f(a=>(null==a?void 0:a.id)===e?{...a,data:{...a.data,...t}}:a)},[u]),z=(0,r.useCallback)(async()=>{let{nodes:e,edges:t}=await ez(x,m);u([...e]),p([...t])},[x,m,u,p]),T=(0,r.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),L=(0,r.useCallback)(e=>{e.preventDefault();let t=e.dataTransfer.getData("application/reactflow");if(!t)return;let{nodeType:a,label:s,actionType:r,category:i}=JSON.parse(t),n=v({x:e.clientX,y:e.clientY}),l={id:"".concat(a,"-").concat(Date.now()),type:a,position:n,data:{label:s,actionType:r,category:i}};u(e=>e.concat(l))},[v,u]),D=e.find(e=>e.id===a),O=(0,r.useCallback)(()=>{if(!D)return;let e=new Blob([JSON.stringify({name:D.name,nodes:x,edges:m,exportedAt:new Date().toISOString()},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(D.name.toLowerCase().replace(/\s+/g,"-"),"-flow.json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},[D,x,m]);return(0,s.jsxs)("div",{className:"flex h-screen w-full flex-col overflow-hidden bg-[#f8fafc]",children:[(0,s.jsxs)("header",{className:"flex h-14 items-center border-b px-4 justify-between bg-white z-20 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(eA(),{href:"/",children:(0,s.jsx)(_.$,{variant:"ghost",size:"icon",className:"text-gray-500 hover:bg-gray-100",children:(0,s.jsx)(ev.A,{className:"w-5 h-5"})})}),(0,s.jsx)(_.$,{variant:"ghost",size:"icon",onClick:()=>d(!o),className:"text-gray-500 hover:bg-gray-100 border-l rounded-none pl-4 ml-0",children:o?(0,s.jsx)(ej.A,{className:"w-5 h-5"}):(0,s.jsx)(eN.A,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h1",{className:"text-sm font-bold text-gray-900 leading-tight",children:null==D?void 0:D.name}),(0,s.jsx)("span",{className:"text-[10px] text-gray-400 font-medium",children:c&&D&&(0,s.jsxs)(s.Fragment,{children:["Lưu tự động l\xfac ",new Date(D.updatedAt).toLocaleTimeString()]})})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(_.$,{variant:"ghost",size:"sm",onClick:O,className:"text-gray-500 font-medium h-8 px-3 cursor-pointer",children:[(0,s.jsx)(ew.A,{className:"w-3.5 h-3.5 mr-2"})," Tải JSON"]})})]}),(0,s.jsxs)("main",{className:"flex flex-1 overflow-hidden relative",children:[o&&(0,s.jsx)("aside",{className:"w-64 border-r overflow-hidden flex flex-col bg-white absolute inset-y-0 left-0 z-30 shadow-xl transition-all duration-300",children:(0,s.jsx)(eu,{flows:e,activeFlowId:a,onSelect:e=>{N(e),d(!1)},onCreate:w})}),(0,s.jsx)(eb,{onSelectTemplate:k}),(0,s.jsx)("div",{className:"flex-1 relative",children:(0,s.jsx)(F,{nodes:x,edges:m,onNodesChange:h,onEdgesChange:b,onConnect:A,onNodeClick:C,onDrop:L,onDragOver:T,onLayout:z})}),(0,s.jsx)("aside",{className:"w-80 border-l bg-white p-4 overflow-y-auto z-10 shadow-sm",children:(0,s.jsx)(eo,{selectedNode:y,onUpdate:S})})]})]})}function eD(){return(0,s.jsx)(n.Ln,{children:(0,s.jsx)(eL,{})})}},3312:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var s=a(5155);a(2115);var r=a(1027),i=a(2317),n=a(1567);let l=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",xs:"h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-xs":"size-6 rounded-md [&_svg:not([class*='size-'])]:size-3","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a="default",size:r="default",asChild:o=!1,...d}=e,c=o?i.bL:"button";return(0,s.jsx)(c,{"data-slot":"button","data-variant":a,"data-size":r,className:(0,n.cn)(l({variant:a,size:r,className:t})),...d})}},1567:(e,t,a)=>{"use strict";a.d(t,{cn:()=>i});var s=a(3463),r=a(9795);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[946,238,862,125,205,441,517,358],()=>t(3332)),_N_E=e.O()}]);